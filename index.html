<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Buggy Table Test</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            padding: 20px;
            background-color: #f4f4f9;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h2 { text-align: center; color: #d9534f; } /* Red title to indicate danger/bug */
        p { text-align: center; color: #555; }
        
        table { width: 100%; border-collapse: collapse; margin-top: 10px; }
        th, td { padding: 12px 15px; text-align: left; border-bottom: 1px solid #ddd; }
        
        th {
            background-color: #333;
            color: white;
            cursor: pointer;
            user-select: none;
        }
        th:hover { background-color: #555; }
        
        /* Highlight the static column slightly so the interviewer can track it */
        td:nth-child(4) {
            background-color: #fff9e6; 
            color: #d9534f;
            font-weight: bold;
        }
    </style>
</head>
<body>

<div class="container">
    <h2>QC Test: Sort Integrity</h2>
    <p><strong>Candidate Instruction:</strong> "Test if the sorting functionality works correctly."</p>
    <p style="font-size: 0.9em; color: #888;">(Internal Note: Sorting ID, Name, or Age will break the relationship with City)</p>

    <table id="buggyTable">
        <thead>
            <tr>
                <th onclick="sortBuggy(0, true)">ID</th>
                <th onclick="sortBuggy(1, false)">Name</th>
                <th onclick="sortBuggy(2, true)">Age</th>
                <th onclick="sortBuggy(3, false)">City</th>
            </tr>
        </thead>
        <tbody>
            <tr><td>1</td><td>Alice</td><td>25</td><td>New York</td></tr>
            <tr><td>2</td><td>Bob</td><td>30</td><td>London</td></tr>
            <tr><td>3</td><td>Charlie</td><td>22</td><td>Paris</td></tr>
            <tr><td>4</td><td>David</td><td>35</td><td>Tokyo</td></tr>
            <tr><td>5</td><td>Eve</td><td>28</td><td>Berlin</td></tr>
            <tr><td>6</td><td>Frank</td><td>40</td><td>Sydney</td></tr>
            <tr><td>7</td><td>Grace</td><td>24</td><td>Toronto</td></tr>
            <tr><td>8</td><td>Hank</td><td>31</td><td>Mumbai</td></tr>
            <tr><td>9</td><td>Ivy</td><td>29</td><td>Beijing</td></tr>
            <tr><td>10</td><td>Jack</td><td>27</td><td>Dubai</td></tr>
        </tbody>
    </table>
</div>

<script>
    // Global variable to track sort direction
    let sortDirection = 'asc';

    function sortBuggy(colIndex, isNumber) {
        let table = document.getElementById("buggyTable");
        let tbody = table.tBodies[0];
        let rowLength = tbody.rows.length;
        
        // 1. Extract the data from the columns we WANT to sort (0, 1, 2)
        // We purposefully IGNORE column 3 (City) in this array
        let dataToSort = [];
        for (let i = 0; i < rowLength; i++) {
            let cells = tbody.rows[i].cells;
            dataToSort.push({
                id: cells[0].innerText,
                name: cells[1].innerText,
                age: cells[2].innerText,
                // We grab the value of the clicked column specifically for sorting purposes
                sortValue: cells[colIndex].innerText 
            });
        }

        // 2. Sort the extracted data (Logic is correct here)
        dataToSort.sort((a, b) => {
            let valA = isNumber ? parseFloat(a.sortValue) : a.sortValue.toLowerCase();
            let valB = isNumber ? parseFloat(b.sortValue) : b.sortValue.toLowerCase();

            if (valA < valB) return sortDirection === 'asc' ? -1 : 1;
            if (valA > valB) return sortDirection === 'asc' ? 1 : -1;
            return 0;
        });

        // Toggle direction for next click
        sortDirection = (sortDirection === 'asc') ? 'desc' : 'asc';

        // 3. THE BUG: We overwrite cells 0, 1, and 2 with sorted data.
        // But we DO NOT touch cell 3. Cell 3 stays in its original visual position.
        
        // Note: If the user clicked column 3 (City), we only update column 3 
        // and leave 0,1,2 alone? 
        // To make the bug obvious: We will update 0, 1, and 2 based on the sort,
        // but we never move the 4th cell.
        
        if(colIndex === 3) {
            // Special case: If they sort by City, we sort ONLY city strings, nothing else moves.
             // This is a "Column Sort Only" bug.
             let cityData = [];
             for (let i = 0; i < rowLength; i++) cityData.push(tbody.rows[i].cells[3].innerText);
             
             cityData.sort();
             if(sortDirection === 'asc') cityData.reverse(); // simple toggle logic match

             for (let i = 0; i < rowLength; i++) {
                 tbody.rows[i].cells[3].innerText = cityData[i];
             }
        } else {
            // Standard Case: Sort ID/Name/Age, but City stays frozen.
            for (let i = 0; i < rowLength; i++) {
                let row = tbody.rows[i];
                row.cells[0].innerText = dataToSort[i].id;
                row.cells[1].innerText = dataToSort[i].name;
                row.cells[2].innerText = dataToSort[i].age;
                // BUG: We explicitly do NOT update row.cells[3] (City)
            }
        }
    }
</script>

</body>
</html>